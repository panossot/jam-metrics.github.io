<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<head>
  <title>JAM-Metrics</title>
  <meta name="description" content="JAM-Metrics" />
  <meta name="keywords" content="jboss automated metrics, jboss, wildfly, metrics, databases, rhq, deployments, monitoring, storage" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <link rel="stylesheet" type="text/css" href="css/style.css" />
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/image_slide.js"></script>
  <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-67279535-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>

<body>
  <div id="main">
    <div id="header">
	  <div id="banner">
	    <div id="welcome">
	      <h1>JAM-Metrics</h1>
	    </div><!--close welcome-->
	    <div id="menubar">
          <ul id="menu">
            <li><a href="index.html">Home</a></li>
            <li class="current"><a href="projects.html">Projects</a></li>
            <li><a href="features.html">Features</a></li>
            <li><a href="ourwork.html">Repo</a></li>
            <li><a href="contact.html">Contact Us</a></li>
          </ul>
        </div><!--close menubar-->	  
	  </div><!--close banner-->	
    </div><!--close header-->	
	
	<div id="site_content">
	
      <div class="slideshow">  
		<ul class="slideshow">
          <li class="show"><img width="900" height="350" src="images/lion_1.jpg" alt="&quot;Looking for deployable metrics? Try JAM-Metrics.&quot;" /></li>
          <li><img width="900" height="350" src="images/lion_1.jpg" alt="&quot;Looking for deployable metrics? Try JAM-Metrics.&quot;" /></li>
        </ul> 
      </div><!--close slideshow-->	 	
	
      <div id="content">
        <div class="content_item" align="center">
          <h2>Standalone Wildfly Library</h2>
                        <div align="justify">
                        	<p>JAM-Metrics are available as a Standalone Wildfly Library (Release 1.0.0.Final). This library can be used to facilitate the creation, record and monitoring of metrics for any deployment on Wildfly Server. This is done by annotating any class or method with the annotations @Metric and @DBStore. An example of usage can be found under the folder <a href="https://github.com/panossot/jam-metrics/tree/master/ApplicationMetricsStandalone/ApplicationMetricsApiTest">ApplicationMetricsApiTest</a>. Deploy the generated .war file on the Wildfly server to see the metrics being printed.<br/><br/>For example, if we annotate the countMethod method below, with the annotations @Metric(fieldName = {"count","count2"}, groupName="myTestGroup") and @DBStore(groupName = "myGroup", queryUpdateDB = {"StoreDBMetric","count"}, statementName = "statement_1") :</p><br/>
	<pre class="prettyprint">
    @Stateful  
    @LocalBean  
    public class MetricsApiSessionBean {  
      
        private int count = 0;  
      
        private int count2 = 0;  
      
        public MetricsApiSessionBean() {  
        }  
      
        @Metric(fieldName = {"count","count2"}, grouptName = "myGroup")  // The annotation parameter groupName is used for grouping 
                                                                         // of metrics under the same metric-properties configuration.  
        @DBStore(groupName = "myGroup", queryUpdateDB = {"StoreDBMetric","count"}, statementName = "statement_1") // Annotation that 
                                                                     // enables the storage of JAM-Metrics in the database
        public int countMethod() {  
            count++;  
            count2 += 2;  
      
            return count;  
        }  
      
    }</pre><br/>
     <p>and we call the method countMethod two sequential times :</p>
<pre class="prettyprint">
        public class PrintMetrics extends HttpServlet {  
        @EJB  
        private MetricsApiSessionBean metricsApiSessionBean;  
      
        private String grouptName = "myGroup";  // The annotation parameter groupName is used for grouping of metrics under 
                                                // the same metric-properties configuration.  
      
        protected void processRequest(HttpServletRequest request, HttpServletResponse response)  
                throws ServletException, IOException {  
            response.setContentType("text/html;charset=UTF-8");  
            initializeMetricProperties();  // Using  MetricsPropertiesApi to configure JAM-Metrics.  All the 
              // configuration needed is done inside the deployment (no xml configurations needed, no System Properties to be set)  
      
            try (PrintWriter out = response.getWriter()) {  
                out.println("<" + "!DOCTYPE html" + ">");  
                out.println("<" + "html" + ">");  
                out.println("<" + "head" + ">");  
                out.println("<" + "title" + ">" + "Servlet PrintMetrics" + "</" + "title" + ">");  
                out.println("<" + "/head" + ">");  
                out.println("<" + "body" + ">");  
                out.println("Servlet PrintMetrics : ");  
                metricsApiSessionBean.countMethod();  
                metricsApiSessionBean.countMethod();  
                out.println(MetricsCacheApi.printMetricsCache(groupName));  
                out.println("Successful Run ..");  
                out.println("<" + "/body" + ">");  
                out.println("<" + "/html" + ">");  
            }  
        }  
      
        private void initializeMetricProperties() {  
            HashMap<String,String> rhqScheduleIds = new HashMap<String,String>();  
            rhqScheduleIds.put("count", "11401");   // 1st Metric-Field name - Equivalent Schedule Id (Retrieved from the RHQ 
                                                    // resources - http://RHQserverUrl:7080/rest/resource?ps=99999)  
            rhqScheduleIds.put("count2", "11402");  // 2nd  Metric-Field name - Equivalent Schedule Id (Retrieved from the RHQ 
                                                    // resources - http://RHQserverUrl:7080/rest/resource?ps=99999)  
            MetricProperties metricProperties = new MetricProperties();  
            metricProperties.setRhqMonitoring("true");  // Enabling the RHQ Monitoring operation.  
            metricProperties.setCacheStore("true");  // Enabling the Cache Storage operation.  
            metricProperties.setRhqServerUrl("lz-panos-jon33.bc.jonqe.lab.eng.bos.redhat.com");  // Adding the RHQ server URL.  
            metricProperties.setRhqScheduleIds(rhqScheduleIds);  // Adding the RHQ Schedule Ids of the metrics we want to monitor.  
            metricProperties.setDatabaseStore("false");  // Disabling the Database Storage operation.
            MetricsPropertiesApi.storeProperties(groupName, metricProperties);  
        }  
                                                .                                   .  
      
    } </pre><br/>
     <p>then the field-metrics will be automatically stored in our metrics cache :</p>
     <pre class="prettyprint">
	Metric Field Name : count (of instance org.jam.metrics.MetricsApiSessionBean@43f98edf)
        Value : 1
        Value : 2

        Metric Field Name : count2 (of instance org.jam.metrics.MetricsApiSessionBean@43f98edf)
        Value : 2
        Value : 4
     </pre><br/>
     <p>and they will be monitored via RHQ :</p>
     <div align="middle">
          <img src="images/rhqCountMetric.png" alt="monitoring of count metric" height="320px" width="540px"><br/><br/><br/>
          <img src="images/rhqCount2Metric.png" alt="monitoring of count2 metric" height="320px" width="540px"><br/><br/>
     </div>

     <p>In addition, <b>if we enable and configure database storage</b> then metric <i>count</i> will be stored in the database : </p>
     <pre class="prettyprint">
        ID     METRIC_NAME     METRIC_VALUE                 METRIC_INSTANCE                              RECORD_TIME

        1        count             1          org.jam.metrics.MetricsApiSessionBean@43f98edf       2015-07-30 16:01:35
        2        count             2          org.jam.metrics.MetricsApiSessionBean@43f98edf       2015-07-30 16:01:35
     </pre><br/>

     <p>An example of usage about database storage can be found under the folder <a href="https://github.com/panossot/jam-metrics/tree/master/ApplicationMetricsStandalone/ApplicationMetricsApiTest6">ApplicationMetricsApiTest6</a>.</p>
                        </div>
	    </div><!--close content_item-->
      </div><!--close content-->   

           <div class="container">
	    <div class="ourwork">
	      <h3>Standalone Wildfly Library</h3>
		  <p>JAM-Metrics are available as a Standalone Wildfly Library (Release 1.0.0.Final) ...</p>
		  <div class="more">
		    <a href="wildflyStandaloneVersion.html">Read more</a>
		  </div><!--close more-->      
	    </div><!--close ourwork-->
	    <div class="testimonials">
	      <h3>Wildfly Optional Subsystem</h3>
		  <p>JAM-Metrics are available as a Wildfly Optional Subsystem ...</p>	  
		  <div class="more">
		    <a href="wildflySubsystemVersion.html">Read more</a>
		  </div><!--close more-->        
	    </div><!--close testimonials-->	  
	    <div class="projects">
	      <h3>Java SE Library</h3>
		  <p>JAM-Metrics are available as a Java SE Standalone Library ...</p>	  
		  <div class="more">
		    <a href="javaSEversion.html">Read more</a>
		  </div><!--close more-->        
	    </div><!--close projects-->
	  </div><!--close container-->

	</div><!--close site_content--> 

	<div id="content_cream">
	  <div class="content_cream_container_box">
		<h4>Projects</h4>
	    <p> JAM-Metrics are divided in three projects ...</p>
		<div class="readmore">
		  <a href="projects.html">Read more</a>
		</div><!--close readmore-->
	  </div><!--close content_cream_container_box-->
      <div class="content_cream_container_box">
       <h4>Features</h4>
	    <p> JAM-Metrics have three main features ...</p>
	    <div class="readmore">
		  <a href="features.html">Read more</a>
		</div><!--close readmore-->
	  </div><!--close content_cream_container_box-->
      <div class="content_cream_container_boxl">
		<h4>Contact Us</h4>
	    <p> If you would like any support using JAM-Metrics, ...</p>
	    <div class="readmore">
		  <a href="contact.html">Read more</a>
		</div><!--close readmore-->	  
	  </div><!--close content_cream_container_box1-->      
	  <br style="clear:both"/>
    </div><!--close content_cream-->   
 
  </div><!--close main-->
  
  <div id="footer_container">
    <div id="footer">
          <font color="FF0000">website template by</font> <a href="http://www.araynordesign.co.uk" style="text-decoration:none;"><font color="FF0000">ARaynorDesign</font></a>
    </div><!--close footer-->  
  </div><!--close footer_container--> 	

</body>

</html>
